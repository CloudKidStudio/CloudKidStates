!function(i,t,n){"use strict";var a=cloudkid.OS,s=cloudkid.SwishSprite,e=cloudkid.MediaLoader,o=function(i,t){this.initialize(i,t)},l=o.prototype,u=null,h=!1,r=null,_=null,p=null,d=null,c=!1,m=0,f=!1,b=0,S=0,y="AudioMute",L="SwishSprite",F=null,g=null;o.VERSION="1.0.0",o.init=function(i,t){return g||new o(i,t),g},Object.defineProperty(o,"instance",{get:function(){return g}}),l.initialize=function(i,t){g||(h=!1,g=this,"object"==typeof i?v(i,t):"string"==typeof i?e.instance.load(i,function(i){return i&&i.content?(v(i.content,t),void 0):(t(!1),void 0)}):t(!1))};var v=function(i,t){u=i;var a=!0;u&&u.resources===n&&(a=!1),u&&u.spritemap===n&&(a=!1),t(a)},P=function(i){if(!F)return!1;if(i!==n){if(!u||!u.spritemap)return!1;if(u.spritemap[i]===n)return!1}return!0};l.getAudioSprite=function(){return F},l.load=function(i){if(u){var t,o,l=e.instance.cacheManager,h=u.resources.length;for(t=0;h>t;t++)o=u.resources[t],u.resources[t]=l.prepare(o.url!==n?o.url:o,!0);F=new s(u),F.manualUpdate=!0;var r=this;F.on(s.LOADED,function(){F.off(s.LOADED).on(s.PROGRESS,r._onUpdate.bind(r)).on(s.COMPLETE,r._onComplete.bind(r)),i()}),a.instance.addUpdateCallback(L,F.update),F.load()}},l.prepare=function(i){P(i)&&F.prepare(i)},l.isPlaying=function(){return!c},l.pause=function(){!c&&F&&r&&(f?this._stopSilence():F.pause(),c=!0)},l.resume=function(){c&&F&&r&&(f?this._startSilence():F.resume(),c=!1)},l.play=function(i,t,n){P(i)&&(c||this.stop(),_=i,r=u.spritemap[i],p=t||null,d=n||null,c=!1,m=0,S=0,f?this._playSilence():this._playAudio())},l._playSilence=function(){b=this.getLength(_),S=F.getPosition(),d&&d(m),this._startSilence()},l._startSilence=function(){a.instance.addUpdateCallback(y,this._updateSilence.bind(this))},l._stopSilence=function(){a.instance.removeUpdateCallback(y)},l._updateSilence=function(i){S+=i/1e3,m=S/b,b>S?d&&d(Math.min(1,Math.max(0,m))):this._onComplete()},l._playAudio=function(){d&&d(m);var i;S>0&&(i=F.getSound(_).start+S),F.play(_,i)},l._onUpdate=function(i){m=i,d&&d(m)},l._onComplete=function(){r&&(r.loop?(m=0,S=0,p&&p()):this.stop(!0))},l.stop=function(i){m=0,S=0,d=null,_=null,r=null,c=!0,b=0,this._stopSilence();var t=p;p=null,F&&F.stop(),i===n&&(i=!1),i&&null!==t&&t()},l.getLength=function(i){return u&&u.spritemap[i]!==n?u.spritemap[i].end-u.spritemap[i].start:0},l.mute=function(){f||(f=!0,F&&r&&(F.pause(),c||this._playSilence()))},l.unmute=function(){f&&(f=!1,F&&r&&(this._stopSilence(),c||this._playAudio()))},l.getMuted=function(){return f},l.isLooping=function(i){return P(i)?u.spritemap[i].loop:void 0},l.getAliases=function(i){var t,n=[];if(i)for(t in u.spritemap)n.push(t);else for(t in u.spritemap)"silence"!=t&&n.push(t);return n},l.destroy=function(){h||(this.stop(),F&&(a.instance.removeUpdateCallback(L),F.destroy()),g=F=u=r=_=d=p=null,h=!0)},namespace("cloudkid").Audio=o}(window,document),function(i){"use strict";var t=cloudkid.Audio,n=cloudkid.OS,a=cloudkid.Captions,s=cloudkid.Animator,e=cloudkid.PageVisibility,o=function(i,t,n,a,s){this.initialize(i,t,n,a,s)},l=o.prototype,u=null,h=0;l._clip=null,l._visibility=null,l._audioAlias=null,l._frameLabel=null,l._animStartFrame=0,l._animEndFrame=null,l._animDuration=0,l._audioStartFrame=0,l._audioDuration=0,l._audioStarted=!1,l._animationFPS=24,l._totalLoops=1,l._currentLoop=0,l._lastProgress=0,l.paused=!1,l._animation=null,l._playCompleteCallback=null,l._audioDone=!1,l._animDone=!1,l._syncDiff=2,l._handleCaptions=!1,l._captionUpdate=null,l.initialize=function(a,s,o,l,r){this._clip=a,this._audioAlias=s,this._frameLabel=o===i?null:o,this._totalLoops=l===i?1:l,null!==this._frameLabel?(this._animStartFrame=this._clip.timeline.resolve(this._frameLabel),1==this._totalLoops?(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_stop"),this._animEndFrame===i&&(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_loop"))):(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_loop"),this._animEndFrame===i&&(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_stop")))):this._animEndFrame=this._clip.timeline.duration-1,this._audioStartFrame=r===i?this._animStartFrame:r,this._animDuration=this._animEndFrame-this._animStartFrame,null===u&&(u=t.instance),h++,this._animationFPS=n.instance.fps,this._audioDuration=Math.round(u.getLength(this._audioAlias)*this._animationFPS),this._audioDuration!=this._animDuration&&u.isLooping(this._audioAlias)&&Debug.warn("The sound '"+this._audioAlias+"' and animation '"+this._frameLabel+"' aren't the same length (sound: "+this._audioDuration+", animation: "+this._animDuration+")");var _=this,p=-1;this._visibility=new e(function(){0===p&&_._animation&&_._animation.setPaused(!1),p=-1},function(){-1===p&&(p=_.paused?1:0),_._animation&&_._animation.setPaused(!0)})},l.play=function(t){u.stop(),this._playCompleteCallback=t!==i?t:null,this._currentLoop=1,this._handleCaptions=a&&a.instance&&a.instance.hasCaption(this._audioAlias),this._captionUpdate=this._handleCaptions?a.instance.run(this._audioAlias):null,this._startPlayback()},l._startPlayback=function(){this._animation=null,this._lastProgress=0,this._audioDone=!1,this._animDone=!1,this.paused=!1,this._audioStartFrame<=this._animStartFrame+this._syncDiff?(this._audioStarted=!0,this._animation=s.play(this._clip,this._frameLabel,this._animationFinished.bind(this),null,!0),u.play(this._audioAlias,this._audioFinished.bind(this),this._update.bind(this))):(this._clip.timeline.addEventListener("change",this._onFrameUpdate.bind(this)),u.prepare(this._audioAlias),this._audioStarted=!1,this._animation=s.play(this._clip,this._frameLabel,this._animationFinished.bind(this),null,!0))},l._audioFinished=function(){!this._animDone&&this._animation&&this._animation.getPaused()&&this._animation.setPaused(!1),this._audioDone=!0,this._doneCheck()},l._animationFinished=function(){this._animation&&(this._animation.onComplete=null),this._animDone=!0,this._doneCheck()},l.pause=function(){this.paused||(this.paused=!0,u.pause(),this._animation&&this._animation.setPaused(!0))},l.resume=function(){this.paused&&(this.paused=!1,u.resume(),this._animation&&this._animation.setPaused(!1))},l.stop=function(t){u.stop(),s.stop(this._clip),this.paused=!0,this._animation=null,t=t===i?!1:t,this._playCompleteCallback&&t&&this._playCompleteCallback(),this._playCompleteCallback=null},l._doneCheck=function(){if(this._animDone&&this._audioDone){var i=0===this._totalLoops;i||this._totalLoops>1?i||this._currentLoop<this._totalLoops?(s.stop(this._clip),this._currentLoop++,this._startPlayback()):this.stop(!0):this.stop(!0)}},l._update=function(i){if(!this.paused&&(this._captionUpdate&&this._captionUpdate(i),i>this._lastProgress)){if(1==i&&0===this._lastProgress)return;if(this._lastProgress=i,this._animDone)return;var t=parseInt(this._audioStartFrame,10)+Math.round(this._audioDuration*this._lastProgress),n=this._clip.timeline.position;t>n?(this._animation.getPaused()&&this._animation.setPaused(!1),t>this._animEndFrame?this._animationFinished():this._clip.gotoAndPlay(t)):t+this._syncDiff<n&&1!=this._lastProgress&&this._animation.setPaused(!0)}},l._onFrameUpdate=function(){!this._audioStarted&&this._clip.timeline.position>=this._audioStartFrame&&(this._audioStarted=!0,u.play(this._audioAlias,this._audioFinished.bind(this),this._update.bind(this)),this._clip.timeline.removeAllEventListeners())},l.destroy=function(){h--,0===h&&(u=null),this._visibility&&this._visibility.destroy(),this._visibility=this._clip=this._audioAlias=this._totalLoops=this._frameLabel=this._animStartFrame=this._animEndFrame=this._animDuration=this._totalLoops=this._currentLoop=this._lastProgress=this._animation=null},namespace("cloudkid").AudioAnimation=o}();