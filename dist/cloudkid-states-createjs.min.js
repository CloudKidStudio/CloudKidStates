!function(){var t=cloudkid.Animator,n=(cloudkid.PixiAnimator,cloudkid.StateManager,function(t){this.initialize(t)}),i=n.prototype;i.addEventListener=null,i.removeEventListener=null,i.removeAllEventListeners=null,i.dispatchEvent=null,i.hasEventListener=null,i._listeners=null,createjs.EventDispatcher&&createjs.EventDispatcher.initialize(i),i.stateId=null,i.manager=null,i.panel=null,i._destroyed=!1,i._active=!1,i._isLoading=!1,i._canceled=!1,i._onEnterStateProceed=null,i._onLoadingComplete=null,i._enabled=!1,i._isTransitioning=!1,i.initialize=function(t){this.panel=t},i.getCanceled=function(){return this._canceled},i._internalExitState=function(){if(this._isTransitioning){this._isTransitioning=!1;var n=t;n.stop(this.panel)}this._enabled=!1,this.panel.visible=!1,this._active=!1,this.exitState()},i.exitState=function(){},i._internalExitStateStart=function(){this.exitStateStart()},i.exitStateStart=function(){},i._internalEnterState=function(n){if(this._isTransitioning){this._isTransitioning=!1;var i=t;i.stop(this.panel)}this._enabled=!1,this._active=!0,this._canceled=!1,this._onEnterStateProceed=n,this.enterState(),this._onEnterStateProceed&&(this._onEnterStateProceed(),this._onEnterStateProceed=null)},i.loadingStart=function(){return this._isLoading?(Debug.warn("loadingStart() was called while we're already loading"),void 0):(this._isLoading=!0,this.manager.loadingStart(),this._onLoadingComplete=this._onEnterStateProceed,this._onEnterStateProceed=null,void 0)},i.loadingDone=function(){return this._isLoading?(this._isLoading=!1,this.manager.loadingDone(),this._onLoadingComplete&&(this._onLoadingComplete(),this._onLoadingComplete=null),void 0):(Debug.warn("loadingDone() was called without a load started, call loadingStart() first"),void 0)},i._internalCancel=function(){this._active=!1,this._canceled=!0,this._isLoading=!1,this._internalExitState(),this.cancel()},i.cancel=function(){},i.enterState=function(){},i._internalEnterStateDone=function(){this._canceled||(this.setEnabled(!0),this.enterStateDone())},i.enterStateDone=function(){},i.update=function(){},i.getActive=function(){return this._active},i.transitionIn=function(n){this._isTransitioning=!0;var i=this,e=t;e.play(this.panel,cloudkid.StateManager.TRANSITION_IN,function(){i._isTransitioning=!1,n()})},i.transitionOut=function(n){this._enabled=!1,this._isTransitioning=!0;var i=this,e=t;e.play(this.panel,cloudkid.StateManager.TRANSITION_OUT,function(){i._isTransitioning=!1,n()})},i.getDestroyed=function(){return this._destroyed},i.setEnabled=function(t){this._enabled=t},i.getEnabled=function(){return this._enabled},i.destroy=function(){this.exitState(),this.panel=null,this.manager=null,this._destroyed=!0,this._onEnterStateProceed=null,this._onLoadingComplete=null},namespace("cloudkid").BaseState=n}(),function(t){var n=function(t,n,i){this.initialize(t,n,i)},i=n.prototype;n.TRANSITION_IN="onTransitionStateIn",n.TRANSITION_IN_DONE="onTransitionStateInDone",n.TRANSITION_OUT="onTransitionStateOut",n.TRANSITION_OUT_DONE="onTransitionStateOutDone",n.VISIBLE="onVisible",n.HIDDEN="onHidden",i.currentState=null,i.visibleState=null,i.type=null,i.initialize=function(n,i,e){this.type=n,this.visibleState=e===t?i:e,this.currentState=i},namespace("cloudkid").StateEvent=n}(),function(t){var n=cloudkid.Audio||cloudkid.Sound,i=cloudkid.OS,e=cloudkid.AudioAnimation,a=cloudkid.Animator,s=(cloudkid.BaseState,cloudkid.PixiAnimator,cloudkid.StateEvent),o=createjs.EventDispatcher,r=(createjs.MovieClip,createjs.Touch);StateManager=function(t,n){this.initialize(t,n)};var l=StateManager.prototype;l.addEventListener=null,l.removeEventListener=null,l.removeAllEventListeners=null,l.dispatchEvent=null,l.hasEventListener=null,l._listeners=null,o&&o.initialize(l),StateManager.VERSION="1.0.0",l._transition=null,l._transitionSounds=null,l._curSound=null,l._canPlayAudio=!1,l._inSoundAnim=null,l._outSoundAnim=null,l._states=null,l._state=null,l._stateId=null,l._oldState=null,l._isLoading=!1,l._isTransitioning=!1,l._destroyed=!1,l._queueStateId=null,StateManager.TRANSITION_IN="onTransitionIn",StateManager.TRANSITION_IN_DONE="onTransitionInDone",StateManager.TRANSITION_OUT="onTransitionOut",StateManager.TRANSITION_OUT_DONE="onTransitionOutDone",StateManager.DIALOG_SHOW="onBlockerShow",StateManager.DIALOG_SHOW_DONE="onBlockerShowDone",StateManager.DIALOG_HIDE="onBlockerHide",StateManager.DIALOG_HIDE_DONE="onBlockerHideDone",StateManager.TRANSITION_INIT="onInit",StateManager.TRANSITION_INIT_DONE="onInitDone",StateManager.LOADING_START="onLoadingStart",StateManager.LOADING_DONE="onLoadingDone",l.initialize=function(t,i){this._transition=t,this._transition.stop(),i&&(this._transitionSounds=i),n&&i&&(this._canPlayAudio=!0),this.hideBlocker(),this._states={}},l.addState=function(t,n){this._states[t]=n,n.stateId=t,n.manager=this,n._internalExitState()},l.changeTransition=function(t){this._transition=t},l.getState=function(){return this._stateId},l.getCurrentState=function(){return this._state},l.getStateById=function(n){return Debug.assert(this._states[n]!==t,"No alias matching "+n),this._states[n]},l.isBusy=function(){return this._isLoading||this._isTransitioning},l.loadingStart=function(){this._destroyed||this.dispatchEvent(StateManager.LOADING_START)},l.loadingDone=function(){this._destroyed||this.dispatchEvent(StateManager.LOADING_DONE)},l.showBlocker=function(){var t=i.instance.stage;t.enableMouseOver(!1),t.enableDOMEvents(!1),r.disable(t)},l.hideBlocker=function(){var t=i.instance.stage;t.enableMouseOver(!0),t.enableDOMEvents(!0),r.enable(t)},l.refresh=function(){Debug.assert(!!this._state,"No current state to refresh!"),this.setState(this._stateId)},l.setState=function(n){if(Debug.assert(this._states[n]!==t,"No current state mattching id '"+n+"'"),this._isTransitioning)return this._queueStateId=n,void 0;this._stateId=n,this.showBlocker(),this._oldState=this._state,this._state=this._states[n];var i;this._oldState?this._isLoading?(this._oldState._internalCancel(),this._isLoading=!1,this._state._internalEnterState(this._onStateLoaded)):(this._isTransitioning=!0,this._oldState._internalExitStateStart(),i=this,this.dispatchEvent(new s(s.TRANSITION_OUT,this._state,this._oldState)),this._oldState.transitionOut(function(){i.dispatchEvent(new s(s.TRANSITION_OUT_DONE,i._state,i._oldState)),i.dispatchEvent(StateManager.TRANSITION_OUT),i._transitioning(StateManager.TRANSITION_OUT,function(){i.dispatchEvent(StateManager.TRANSITION_OUT_DONE),i._isTransitioning=!1,i.dispatchEvent(new s(s.HIDDEN,i._state,i._oldState)),i._oldState.panel.visible=!1,i._oldState._internalExitState(),i._oldState=null,i._processQueue()||(i._isLoading=!0,i._state._internalEnterState(i._onStateLoaded.bind(i)))})})):(this._isTransitioning=!0,this._transition.visible=!0,i=this,this._transition.gotoAndStop(StateManager.TRANSITION_IN),a.play(i._transition,"transitionloop",null,!0),i.dispatchEvent(StateManager.TRANSITION_INIT_DONE),i._isLoading=!0,i._state._internalEnterState(i._onStateLoaded.bind(i)))},l._onStateLoaded=function(){this._isLoading=!1,this._isTransitioning=!0,this.dispatchEvent(new s(s.VISIBLE,this._state)),this._state.panel.visible=!0,this.dispatchEvent(StateManager.TRANSITION_IN);var t=this;this._transitioning(StateManager.TRANSITION_IN,function(){t._transition.visible=!1,t.dispatchEvent(StateManager.TRANSITION_IN_DONE),t.dispatchEvent(new s(s.TRANSITION_IN,t._state)),t._state.transitionIn(function(){t.dispatchEvent(new s(s.TRANSITION_IN_DONE,t._state)),t._isTransitioning=!1,t.hideBlocker(),t._processQueue()||t._state._internalEnterStateDone()})})},l._processQueue=function(){if(this._queueStateId){var t=this._queueStateId;return this._queueStateId=null,this.setState(t),!0}return!1},l.showTransitionOut=function(t){this.showBlocker();this._transitioning(StateManager.TRANSITION_OUT,t)},l.showTransitionIn=function(t){var n=this;this._transitioning(StateManager.TRANSITION_IN,function(){n.hideBlocker(),t&&t()})},l._transitioning=function(t,i){var s=this._transition;s.visible=!0;if(this._canPlayAudio&&(this._transitionSounds&&n.instance&&(this._transitionSounds.inSound&&(this._inSoundAnim=new e(this._transition,this._transitionSounds.inSound,StateManager.TRANSITION_IN,1,this._transitionSounds.inSoundStart)),this._transitionSounds.outSound&&(this._outSoundAnim=new e(this._transition,this._transitionSounds.outSound,StateManager.TRANSITION_OUT,1,this._transitionSounds.outSoundStart)),this._transitionSounds=null),n.instance.soundLoaded)){if(this._inSoundAnim&&t==StateManager.TRANSITION_IN)return this._inSoundAnim.play(i),void 0;if(this._outSoundAnim&&t==StateManager.TRANSITION_OUT)return this._outSoundAnim.play(i),void 0}a.play(s,t,i)},l.update=function(t){this._state&&this._state.update(t)},l.destroy=function(){if(this._destroyed=!0,a.stop(this._transition),this._transition=null,this._state=null,this._oldState=null,this._states)for(var t in this._states)this._states[t].destroy(),delete this._states[t];this._states=null},namespace("cloudkid").StateManager=StateManager}();