!function(){"use strict";var t,i=function(i){t=cloudkid.StateManager,this.initialize(i)},n=i.prototype;n.addEventListener=null,n.removeEventListener=null,n.removeAllEventListeners=null,n.dispatchEvent=null,n.hasEventListener=null,n._listeners=null,createjs.EventDispatcher&&createjs.EventDispatcher.initialize(n),n.stateId=null,n.manager=null,n.panel=null,n._destroyed=!1,n._active=!1,n._isLoading=!1,n._canceled=!1,n._onEnterStateProceed=null,n._onLoadingComplete=null,n._enabled=!1,n._isTransitioning=!1,n.initialize=function(t){this.panel=t},n.getCanceled=function(){return this._canceled},n._internalExitState=function(){this._isTransitioning&&(this._isTransitioning=!1,this.manager._display.Animator.stop(this.panel)),this._enabled=!1,this.panel.visible=!1,this._active=!1,this.exitState()},n.exitState=function(){},n._internalExitStateStart=function(){this.exitStateStart()},n.exitStateStart=function(){},n._internalEnterState=function(t){this._isTransitioning&&(this._isTransitioning=!1,this.manager._display.Animator.stop(this.panel)),this._enabled=!1,this._active=!0,this._canceled=!1,this._onEnterStateProceed=t,this.enterState(),this._onEnterStateProceed&&(this._onEnterStateProceed(),this._onEnterStateProceed=null)},n.loadingStart=function(){return this._isLoading?void Debug.warn("loadingStart() was called while we're already loading"):(this._isLoading=!0,this.manager.loadingStart(),this._onLoadingComplete=this._onEnterStateProceed,void(this._onEnterStateProceed=null))},n.loadingDone=function(){return this._isLoading?(this._isLoading=!1,this.manager.loadingDone(),void(this._onLoadingComplete&&(this._onLoadingComplete(),this._onLoadingComplete=null))):void Debug.warn("loadingDone() was called without a load started, call loadingStart() first")},n._internalCancel=function(){this._active=!1,this._canceled=!0,this._isLoading=!1,this._internalExitState(),this.cancel()},n.cancel=function(){},n.enterState=function(){},n._internalEnterStateDone=function(){this._canceled||(this.setEnabled(!0),this.enterStateDone())},n.enterStateDone=function(){},n.getActive=function(){return this._active},n.transitionIn=function(i){this._isTransitioning=!0;var n=this;this.manager._display.Animator.play(this.panel,t.TRANSITION_IN,function(){n._isTransitioning=!1,i()})},n.transitionOut=function(i){this._enabled=!1,this._isTransitioning=!0;var n=this;this.manager._display.Animator.play(this.panel,t.TRANSITION_OUT,function(){n._isTransitioning=!1,i()})},n.getDestroyed=function(){return this._destroyed},n.setEnabled=function(t){this._enabled=t},n.getEnabled=function(){return this._enabled},n.destroy=function(){this.exitState(),this.panel=null,this.manager=null,this._destroyed=!0,this._onEnterStateProceed=null,this._onLoadingComplete=null},namespace("cloudkid").BaseState=i}(),function(t){"use strict";var i=function(t,i,n){this.initialize(t,i,n)},n=i.prototype;i.TRANSITION_IN="onTransitionStateIn",i.TRANSITION_IN_DONE="onTransitionStateInDone",i.TRANSITION_OUT="onTransitionStateOut",i.TRANSITION_OUT_DONE="onTransitionStateOutDone",i.VISIBLE="onVisible",i.HIDDEN="onHidden",n.currentState=null,n.visibleState=null,n.type=null,n.initialize=function(i,n,e){this.type=i,this.visibleState=e===t?n:e,this.currentState=n},namespace("cloudkid").StateEvent=i}(),function(t){"use strict";var i=cloudkid.Audio||cloudkid.Sound,n=(cloudkid.BaseState,cloudkid.StateEvent),e=createjs.EventDispatcher,s=function(t,i,n){this.initialize(t,i,n)},a=s.prototype;a.addEventListener=null,a.removeEventListener=null,a.removeAllEventListeners=null,a.dispatchEvent=null,a.hasEventListener=null,a._listeners=null,e&&e.initialize(a),s.VERSION="1.1.3",a._display=null,a._transition=null,a._transitionSounds=null,a._states=null,a._state=null,a._stateId=null,a._oldState=null,a._isLoading=!1,a._isTransitioning=!1,a._destroyed=!1,a._queueStateId=null,s.TRANSITION_IN="onTransitionIn",s.TRANSITION_IN_DONE="onTransitionInDone",s.TRANSITION_OUT="onTransitionOut",s.TRANSITION_OUT_DONE="onTransitionOutDone",s.TRANSITION_INIT_DONE="onInitDone",s.LOADING_START="onLoadingStart",s.LOADING_DONE="onLoadingDone",a.initialize=function(t,i,n){this._display=t,this._transition=i,this._transition.stop&&this._transition.stop(),this.hideBlocker(),this._states={},this._transitionSounds=n||null,this._loopTransition=this._loopTransition.bind(this)},a.addState=function(t,i){this._states[t]=i,i.stateId=t,i.manager=this,i._internalExitState()},a.changeTransition=function(t){this._transition=t},a.getState=function(){return this._stateId},a.getCurrentState=function(){return this._state},a.getStateById=function(i){return Debug.assert(this._states[i]!==t,"No alias matching "+i),this._states[i]},a.isBusy=function(){return this._isLoading||this._isTransitioning},a.loadingStart=function(){this._destroyed||(this.dispatchEvent(s.LOADING_START),this._loopTransition())},a.loadingDone=function(){this._destroyed||this.dispatchEvent(s.LOADING_DONE)},a.showBlocker=function(){this._display.enabled=!1},a.hideBlocker=function(){this._display.enabled=!0},a.refresh=function(){Debug.assert(!!this._state,"No current state to refresh!"),this.setState(this._stateId)},a.setState=function(i){if(Debug.assert(this._states[i]!==t,"No current state mattching id '"+i+"'"),this._isTransitioning)return void(this._queueStateId=i);this._stateId=i,this.showBlocker(),this._oldState=this._state,this._state=this._states[i];var e;this._oldState?this._isLoading?(this._oldState._internalCancel(),this._isLoading=!1,this._state._internalEnterState(this._onStateLoaded)):(this._isTransitioning=!0,this._oldState._internalExitStateStart(),this.showBlocker(),e=this,this.dispatchEvent(new n(n.TRANSITION_OUT,this._state,this._oldState)),this._oldState.transitionOut(function(){e.dispatchEvent(new n(n.TRANSITION_OUT_DONE,e._state,e._oldState)),e.dispatchEvent(s.TRANSITION_OUT),e._transitioning(s.TRANSITION_OUT,function(){e.dispatchEvent(s.TRANSITION_OUT_DONE),e._isTransitioning=!1,e.dispatchEvent(new n(n.HIDDEN,e._state,e._oldState)),e._oldState.panel.visible=!1,e._oldState._internalExitState(),e._oldState=null,e._loopTransition(),e._processQueue()||(e._isLoading=!0,e._state._internalEnterState(e._onStateLoaded.bind(e)))})})):(this._isTransitioning=!0,this._transition.visible=!0,e=this,this._loopTransition(),e.dispatchEvent(s.TRANSITION_INIT_DONE),e._isLoading=!0,e._state._internalEnterState(e._onStateLoaded.bind(e)))},a._onStateLoaded=function(){this._isLoading=!1,this._isTransitioning=!0,this.dispatchEvent(new n(n.VISIBLE,this._state)),this._state.panel.visible=!0,this.dispatchEvent(s.TRANSITION_IN);var t=this;this._transitioning(s.TRANSITION_IN,function(){t._transition.visible=!1,t.dispatchEvent(s.TRANSITION_IN_DONE),t.dispatchEvent(new n(n.TRANSITION_IN,t._state)),t._state.transitionIn(function(){t.dispatchEvent(new n(n.TRANSITION_IN_DONE,t._state)),t._isTransitioning=!1,t.hideBlocker(),t._processQueue()||t._state._internalEnterStateDone()})})},a._processQueue=function(){if(this._queueStateId){var t=this._queueStateId;return this._queueStateId=null,this.setState(t),!0}return!1},a._loopTransition=function(){var t;this._transitionSounds&&(t=this._transitionSounds.loop,i.instance.soundLoaded===!1&&(t=null)),this._display.Animator.instanceHasAnimation(this._transition,"transitionLoop")&&this._display.Animator.play(this._transition,"transitionLoop",{onComplete:this._loopTransition,soundData:t})},a.showTransitionOut=function(t){this.showBlocker();var i=this,n=function(){i._loopTransition(),t&&t()};this._transitioning(s.TRANSITION_OUT,n)},a.showTransitionIn=function(t){var i=this;this._transitioning(s.TRANSITION_IN,function(){i.hideBlocker(),t&&t()})},a._transitioning=function(t,n){var e=this._transition;e.visible=!0;var a;this._transitionSounds&&(a=t==s.TRANSITION_IN?this._transitionSounds.in:this._transitionSounds.out,i.instance.soundLoaded===!1&&(a=null)),this._display.Animator.play(this._transition,t,{onComplete:n,soundData:a})},a.destroy=function(){if(this._destroyed=!0,this._display.Animator.stop(this._transition),this._transition=null,this._state=null,this._oldState=null,this._states)for(var t in this._states)this._states[t].destroy(),delete this._states[t];this._states=null},namespace("cloudkid").StateManager=s}();